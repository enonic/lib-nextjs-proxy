// Build library: gradlew build
// Install library locally for development with: gradlew install

plugins {
    id 'java'
    id 'maven-publish'
    id 'com.enonic.defaults' version '2.0.1'
    id 'com.enonic.xp.base' version '3.2.0'
    id "com.github.node-gradle.node" version "3.4.0"
}

dependencies {
    compileOnly "com.enonic.xp:core-api:${xpVersion}"
    compile "com.enonic.xp:lib-event:${xpVersion}"

    //compile "com.enonic.xp:lib-io:${xpVersion}"
    compile "com.enonic.xp:lib-portal:${xpVersion}"
    // compile "com.enonic.xp:lib-context:${xpVersion}"
    // compile "com.enonic.xp:lib-repo:${xpVersion}"
    // compile "com.enonic.xp:lib-node:${xpVersion}"

    compile "com.enonic.lib:lib-http-client:3.1.0"

    // testCompile "com.enonic.xp:testing:${xpVersion}"
}

/*node {
    download = true
    version = '10'
}*/

repositories {
    mavenLocal()
    mavenCentral()
    xp.enonicRepo()
}
/*
def BUILD_ENV = "production"
if (project.hasProperty("dev") || project.hasProperty("development")) {
    BUILD_ENV = "development"
}*/

def LIB_FOLDER = "nextjs-proxy"

task babelLib(type: NodeTask) {
    group 'enonic xp'

    script = file('node_modules/@babel/cli/bin/babel.js')
    args = ["build/resources/main/lib/${LIB_FOLDER}", "--out-dir", "build/resources/main/lib/${LIB_FOLDER}"]

    inputs.dir "build/resources/main/lib/${LIB_FOLDER}"
    outputs.dir("build/resources/main/lib/${LIB_FOLDER}")
}
babelLib.dependsOn += 'processResources'
babelLib.dependsOn += npmInstall

jar.dependsOn += 'babelLib'
